<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DischarGen: The Discharge Template Generator</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="ic-new" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M6 2C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V9.82777C20 9.29733 19.7893 8.78863 19.4142 8.41355L13.5864 2.58579C13.2114 2.21071 12.7027 2 12.1722 2H6ZM5.5 4C5.5 3.72386 5.72386 3.5 6 3.5H12V8C12 9.10457 12.8954 10 14 10H18.5V20C18.5 20.2761 18.2761 20.5 18 20.5H6C5.72386 20.5 5.5 20.2761 5.5 20V4ZM17.3793 8.5H14C13.7239 8.5 13.5 8.27614 13.5 8V4.62066L17.3793 8.5Z" />
    </symbol>
    <symbol id="ic-json" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M4.5 5.75A2.75 2.75 0 0 1 7.25 3a.75.75 0 0 1 0 1.5C6.56 4.5 6 5.06 6 5.75v4.309c0 .744-.3 1.437-.802 1.941A2.75 2.75 0 0 1 6 13.941v4.309c0 .69.56 1.25 1.25 1.25a.75.75 0 0 1 0 1.5a2.75 2.75 0 0 1-2.75-2.75v-4.308a1.25 1.25 0 0 0-.855-1.186l-.132-.045a.75.75 0 0 1 0-1.422l.132-.045c.51-.17.855-.647.855-1.185zm15 0A2.75 2.75 0 0 0 16.75 3a.75.75 0 0 0 0 1.5c.69 0 1.25.56 1.25 1.25v4.309c0 .744.3 1.437.802 1.941A2.75 2.75 0 0 0 18 13.941v4.309c0 .69-.56 1.25-1.25 1.25a.75.75 0 0 0 0 1.5a2.75 2.75 0 0 0 2.75-2.75v-4.308c0-.539.344-1.016.855-1.186l.132-.045a.75.75 0 0 0 0-1.422l-.132-.045a1.25 1.25 0 0 1-.855-1.185z" />
    </symbol>
    <symbol id="ic-pdf" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M3.75 15a2.5 2.5 0 0 1 0 5H2.5v1.25a.75.75 0 0 1-1.5 0v-5.5a.75.75 0 0 1 .75-.75zM2.5 18.5h1.25a1 1 0 1 0 0-2H2.5zM9.25 15A2.75 2.75 0 0 1 12 17.75v1.5A2.75 2.75 0 0 1 9.25 22h-1.5a.75.75 0 0 1-.75-.75v-5.5a.75.75 0 0 1 .75-.75zm-.75 5.5h.75c.69 0 1.25-.56 1.25-1.25v-1.5c0-.69-.56-1.25-1.25-1.25H8.5zm8.25-5.5a.75.75 0 0 1 0 1.5H14.5V18h1.75a.75.75 0 0 1 0 1.5H14.5v1.75a.75.75 0 0 1-1.5 0v-5.5a.75.75 0 0 1 .75-.75zM12.129 2a2.25 2.25 0 0 1 1.59.66l5.622 5.62c.422.422.659.994.659 1.591V19.5a2.5 2.5 0 0 1-2.5 2.5h-2.17a1.74 1.74 0 0 0 .17-.75v-.75h2a1 1 0 0 0 1-1V10H14a2 2 0 0 1-2-2V3.5H6.5a1 1 0 0 0-1 1V14H4V4.5A2.5 2.5 0 0 1 6.5 2zM13.5 8a.5.5 0 0 0 .5.5h3.44L13.5 4.56z" />
    </symbol>
    <symbol id="ic-settings" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M12.012 2.25c.734.008 1.465.093 2.182.253a.75.75 0 0 1 .582.649l.17 1.527a1.384 1.384 0 0 0 1.927 1.116l1.4-.615a.75.75 0 0 1 .85.174a9.8 9.8 0 0 1 2.205 3.792a.75.75 0 0 1-.272.825l-1.241.916a1.38 1.38 0 0 0 0 2.226l1.243.915a.75.75 0 0 1 .272.826a9.8 9.8 0 0 1-2.204 3.792a.75.75 0 0 1-.849.175l-1.406-.617a1.38 1.38 0 0 0-1.926 1.114l-.17 1.526a.75.75 0 0 1-.571.647a9.5 9.5 0 0 1-4.406 0a.75.75 0 0 1-.572-.647l-.169-1.524a1.382 1.382 0 0 0-1.925-1.11l-1.406.616a.75.75 0 0 1-.85-.175a9.8 9.8 0 0 1-2.203-3.796a.75.75 0 0 1 .272-.826l1.243-.916a1.38 1.38 0 0 0 0-2.226l-1.243-.914a.75.75 0 0 1-.272-.826a9.8 9.8 0 0 1 2.205-3.792a.75.75 0 0 1 .85-.174l1.4.615a1.387 1.387 0 0 0 1.93-1.118l.17-1.526a.75.75 0 0 1 .583-.65q1.074-.238 2.201-.252m0 1.5a9 9 0 0 0-1.354.117l-.11.977A2.886 2.886 0 0 1 6.526 7.17l-.899-.394A8.3 8.3 0 0 0 4.28 9.092l.797.587a2.88 2.88 0 0 1 .001 4.643l-.799.588c.32.842.776 1.626 1.348 2.322l.905-.397a2.882 2.882 0 0 1 4.017 2.318l.109.984c.89.15 1.799.15 2.688 0l.11-.984a2.88 2.88 0 0 1 4.018-2.322l.904.396a8.3 8.3 0 0 0 1.348-2.318l-.798-.588a2.88 2.88 0 0 1-.001-4.643l.797-.587a8.3 8.3 0 0 0-1.348-2.317l-.897.393a2.884 2.884 0 0 1-4.023-2.324l-.109-.976a9 9 0 0 0-1.334-.117M12 8.25a3.75 3.75 0 1 1 0 7.5a3.75 3.75 0 0 1 0-7.5m0 1.5a2.25 2.25 0 1 0 0 4.5a2.25 2.25 0 0 0 0-4.5" />
    </symbol>
    <symbol id="ic-menu" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M2.75254 17.9997H21.2525C21.6668 17.9997 22.0025 18.3355 22.0025 18.7497C22.0025 19.1294 21.7204 19.4432 21.3543 19.4928L21.2525 19.4997H2.75254C2.33832 19.4997 2.00254 19.1639 2.00254 18.7497C2.00254 18.37 2.28469 18.0562 2.65077 18.0065L2.75254 17.9997H21.2525H2.75254ZM2.75254 11.5027H21.2525C21.6668 11.5027 22.0025 11.8385 22.0025 12.2527C22.0025 12.6324 21.7204 12.9462 21.3543 12.9959L21.2525 13.0027H2.75254C2.33832 13.0027 2.00254 12.6669 2.00254 12.2527C2.00254 11.873 2.28469 11.5592 2.65077 11.5095L2.75254 11.5027H21.2525H2.75254ZM2.75168 5.00293H21.2517C21.6659 5.00293 22.0017 5.33872 22.0017 5.75293C22.0017 6.13263 21.7195 6.44642 21.3535 6.49608L21.2517 6.50293H2.75168C2.33746 6.50293 2.00168 6.16714 2.00168 5.75293C2.00168 5.37323 2.28383 5.05944 2.64991 5.00978L2.75168 5.00293H21.2517H2.75168Z" />
    </symbol>
    <symbol id="ic-back" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M10.733 19.79a.75.75 0 0 0 1.034-1.086L5.516 12.75H20.25a.75.75 0 0 0 0-1.5H5.516l6.251-5.955a.75.75 0 0 0-1.034-1.086l-7.42 7.067a1 1 0 0 0-.3.58a.8.8 0 0 0 .001.289a1 1 0 0 0 .3.579z" />
    </symbol>
    <symbol id="ic-next" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M13.267 4.209a.75.75 0 0 0-1.034 1.086l6.251 5.955H3.75a.75.75 0 0 0 0 1.5h14.734l-6.251 5.954a.75.75 0 0 0 1.034 1.087l7.42-7.067a1 1 0 0 0 .3-.58a.8.8 0 0 0-.001-.29a1 1 0 0 0-.3-.578z" />
    </symbol>
    <symbol id="ic-copy" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M5.503 4.627L5.5 6.75v10.504a3.25 3.25 0 0 0 3.25 3.25h8.616a2.25 2.25 0 0 1-2.122 1.5H8.75A4.75 4.75 0 0 1 4 17.254V6.75c0-.98.627-1.815 1.503-2.123M17.75 2A2.25 2.25 0 0 1 20 4.25v13a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-13A2.25 2.25 0 0 1 8.75 2zm0 1.5h-9a.75.75 0 0 0-.75.75v13c0 .414.336.75.75.75h9a.75.75 0 0 0 .75-.75v-13a.75.75 0 0 0-.75-.75" />
    </symbol>
    <symbol id="ic-download" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M6 2a2 2 0 0 0-2 2v7.498a6.5 6.5 0 0 1 1.5-.422V4a.5.5 0 0 1 .5-.5h6V8a2 2 0 0 0 2 2h4.5v10a.5.5 0 0 1-.5.5h-5.732A6.5 6.5 0 0 1 11.19 22H18a2 2 0 0 0 2-2V9.828a2 2 0 0 0-.586-1.414l-5.828-5.828A2 2 0 0 0 12.172 2zm11.38 6.5H14a.5.5 0 0 1-.5-.5V4.62zm-5.38 9a5.5 5.5 0 1 1-11 0a5.5 5.5 0 0 1 11 0m-5-3a.5.5 0 0 0-1 0v4.793l-1.646-1.647a.5.5 0 0 0-.708.708l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5a.5.5 0 0 0-.708-.708L7 19.293z" />
    </symbol>
    <symbol id="ic-pdf-preview" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M6.25 4.5A1.75 1.75 0 0 0 4.5 6.25v11.5c0 .966.783 1.75 1.75 1.75h11.5a1.75 1.75 0 0 0 1.75-1.75v-4a.75.75 0 0 1 1.5 0v4A3.25 3.25 0 0 1 17.75 21H6.25A3.25 3.25 0 0 1 3 17.75V6.25A3.25 3.25 0 0 1 6.25 3h4a.75.75 0 0 1 0 1.5zM13 3.75a.75.75 0 0 1 .75-.75h6.5a.75.75 0 0 1 .75.75v6.5a.75.75 0 0 1-1.5 0V5.56l-5.22 5.22a.75.75 0 0 1-1.06-1.06l5.22-5.22h-4.69a.75.75 0 0 1-.75-.75" />
    </symbol>
    <symbol id="ic-print" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M18.5 20a.5.5 0 0 1-.5.5h-5.268a2 2 0 0 1-1.732 1h-.011a2.7 2.7 0 0 1-.093.5H18a2 2 0 0 0 2-2V9.828a2 2 0 0 0-.586-1.414l-5.829-5.828l-.049-.04l-.036-.03a2 2 0 0 0-.219-.18a1 1 0 0 0-.08-.044l-.048-.024l-.05-.029c-.054-.031-.109-.063-.166-.087a2 2 0 0 0-.624-.138q-.03-.002-.059-.007L12.172 2H6a2 2 0 0 0-2 2v7.104Q4.358 11 4.75 11h.75V4a.5.5 0 0 1 .5-.5h6V8a2 2 0 0 0 2 2h4.5zm-5-15.379L17.378 8.5H14a.5.5 0 0 1-.5-.5zM3 13.75c0-.966.784-1.75 1.75-1.75h3.5c.966 0 1.75.784 1.75 1.75v.75h.5A1.5 1.5 0 0 1 12 16v3.5a1 1 0 0 1-1 1h-1v.75A1.75 1.75 0 0 1 8.25 23h-3.5A1.75 1.75 0 0 1 3 21.25v-.75H2a1 1 0 0 1-1-1V16a1.5 1.5 0 0 1 1.5-1.5H3zm5.5 0a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25v.75h4zm-4 5.5v2c0 .138.112.25.25.25h3.5a.25.25 0 0 0 .25-.25v-2a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25" />
    </symbol>
  </svg>
  <div class="app-shell with-nav" id="appShell">
    <nav id="sectionNav" aria-label="Sections" aria-hidden="true">
      <div class="nav-inner">
        <div class="nav-head">
          <h2>Sections</h2>
          <button id="navCloseBtn" class="modal-close nav-close" data-close-nav aria-label="Close"></button>
        </div>
        <div class="nav-search">
          <input id="navSearchInput" type="text" placeholder="Filter sections..." aria-label="Filter sections" />
        </div>
        <ul id="sectionNavList"></ul>
      </div>
      <!-- <div class="nav-backdrop" aria-hidden="true"></div> -->
    </nav>
    <div class="app-main-col">
      <header id="header">
        <div class="app-brand">
          <button id="navMenuBtn" class="icon-button" aria-label="Open navigation"><svg class="icon">
              <use href="#ic-menu" />
            </svg></button>
          <h1>DischarGen</h1>
        </div>
        <div class="actions">
          <div class="actions-group" aria-label="Primary actions">
            <button id="headerNewDischargeBtn" class="icon-button" title="New Discharge"><svg class="icon">
                <use href="#ic-new" />
              </svg></button>
            <button id="jsonBtn" class="icon-button" title="Export JSON"><svg class="icon">
                <use href="#ic-json" />
              </svg></button>
            <button id="pdfBtn" class="icon-button" title="Export PDF"><svg class="icon">
                <use href="#ic-pdf" />
              </svg></button>
          </div>
          <div class="actions-group" aria-label="Display settings">
            <button id="settingsBtn" class="icon-button" title="Settings"><svg class="icon">
                <use href="#ic-settings" />
              </svg></button>
          </div>
        </div>
      </header>
      <main>
        <div id="formContainer" role="form" aria-live="polite">
          <div id="landing" class="landing-screen">
            <div class="landing-card">
              <h1>DischarGen</h1>
              <p class="landing-tagline">Generate structured discharge summaries from smart medical templates.</p>
              <button id="newDischargeBtn">Get Started</button>
              <p class="landing-note">Create a new discharge summary from templates easily.</p>
            </div>
          </div>
        </div>
      </main>
      <footer>
        <p>&copy; ShankarBUS</p>
      </footer>
    </div>
  </div>

  <!-- Start (PIN + Template Selection) Dialog -->
  <dialog id="startModal" class="start-modal" closedby="any" aria-labelledby="startModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="startModalTitle">New Discharge</h2>
        <form method="dialog">
          <button class="modal-close" aria-label="Close" value="cancel"></button>
        </form>
      </div>
      <div class="modal-body start-steps" id="startSteps">
        <!-- Step 1: PIN Entry -->
        <div class="start-step" data-step="pin" id="stepPin">
          <h3>Enter Patient PIN</h3>
          <p class="muted">Provide the patient PIN / identifier to begin the discharge summary.</p>
          <div class="form-row">
            <label for="pinInput" class="required">PIN</label>
            <input id="pinInput" type="text" />
          </div>
        </div>
        <!-- Step 2: Template Selection (Two-Panel) -->
        <div class="start-step hidden" data-step="template" id="stepTemplate">
          <h3>Select Template</h3>
          <div class="two-panel" id="templatePanel">
            <div class="panel panel-depts">
              <div class="panel-head">Departments</div>
              <ul id="deptList" class="list" role="listbox" aria-label="Departments"></ul>
            </div>
            <div class="panel panel-templates">
              <div class="panel-head">
                <input id="templateFilterInput" type="text" placeholder="Search template..."
                  aria-label="Search templates in department" />
              </div>
              <ul id="templateList" class="list" role="listbox" aria-label="Templates"></ul>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="stepBackButton" class="icon-button" title="Back"><svg class="icon">
            <use href="#ic-back" />
          </svg></button>
        <button id="stepNextButton" class="icon-button" title="Next"><svg class="icon">
            <use href="#ic-next" />
          </svg></button>
      </div>
    </div>
  </dialog>

  <!-- Settings Dialog -->
  <dialog id="settingsModal" closedby="any" aria-labelledby="settingsTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="settingsTitle">Settings</h2>
        <form method="dialog"><button class="modal-close" aria-label="Close" value="cancel"></button></form>
      </div>
      <div class="modal-body">
        <fieldset class="field">
          <legend>General</legend>
          <div>
            <input id="autoSaveCheckbox" type="checkbox">
            <label for="autoSaveCheckbox">Enable Autosave</label>
          </div>
        </fieldset>
        <fieldset class="field">
          <legend>Theme</legend>
          <div>
            <input type="radio" id="theme-1" name="themeMode" value="system" checked>
            <label for="theme-1" class="radio-label">System</label>
          </div>
          <div>
            <input type="radio" id="theme-2" name="themeMode" value="light">
            <label for="theme-2" class="radio-label">Light</label>
          </div>
          <div>
            <input type="radio" id="theme-3" name="themeMode" value="dark">
            <label for="theme-3" class="radio-label">Dark</label>
          </div>
        </fieldset>
      </div>
    </div>
  </dialog>

  <!-- JSON Export Dialog -->
  <dialog id="jsonModal" closedby="any" aria-labelledby="jsonTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="jsonTitle">Export JSON</h2>
        <form method="dialog"><button class="modal-close" aria-label="Close" value="cancel"></button></form>
      </div>
      <div class="modal-body">
        <textarea id="jsonPreview" rows="12" style="width:100%;"></textarea>
      </div>
      <div class="modal-footer">
        <button id="copyJsonBtn" class="icon-button" title="Copy JSON"><svg class="icon">
            <use href="#ic-copy" />
          </svg></button>
        <button id="downloadJsonBtn" class="icon-button" title="Download JSON"><svg class="icon">
            <use href="#ic-download" />
          </svg></button>
      </div>
    </div>
  </dialog>

  <!-- PDF Export Dialog -->
  <dialog id="pdfModal" closedby="any" aria-labelledby="pdfTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="pdfTitle">Export PDF</h2>
        <form method="dialog"><button class="modal-close" aria-label="Close" value="cancel"></button></form>
      </div>
      <div class="modal-body">
        <p>Choose an action for the generated PDF.</p>
      </div>
      <div class="modal-footer">
        <button id="pdfPreviewBtn" class="icon-button" title="Preview PDF"><svg class="icon">
            <use href="#ic-pdf-preview" />
          </svg></button>
        <button id="pdfPrintBtn" class="icon-button" title="Print PDF"><svg class="icon">
            <use href="#ic-print" />
          </svg></button>
        <button id="pdfDownloadBtn" class="icon-button" title="Download PDF"><svg class="icon">
            <use href="#ic-download" />
          </svg></button>
      </div>
    </div>
  </dialog>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.18/pdfmake.min.js"></script>
  <script type="module" src="./app.js"></script>
</body>

</html>